#import "iAPVerification.h"

- (void)paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(NSArray *)transactions {
	for (SKPaymentTransaction *transaction in transactions) {
		switch (transaction.transactionState) {
			case SKPaymentTransactionStatePurchased:
				[iAPVerification verifyPurchase:transaction isSandbox:YES delegate:self];
				break;
			
			case SKPaymentTransactionStateRestored:
				[iAPVerification verifyPurchase:transaction isSandbox:YES delegate:self];
				break;
		}
	}
}

- (void)verificationFailed:(iAPErrorCode)errorCode error:(NSError *)error {
	NSLog(@"%d, %@", errorCode, error);
}

- (void)purchaseVerified:(NSDictionary *)dictionary {
	//NSLog(@"%@", dictionary);
	
	NSString *productId = [dictionary objectForKey:@"product_id"];
	
	if ([productId isEqualToString:@"com.powerflightapp.iap.1"]) {
		// Provide content
	}
	
	SKPaymentQueue *queue = [SKPaymentQueue defaultQueue];
	NSString *transactionId = [dictionary objectForKey:@"transaction_id"];
	
	for (SKPaymentTransaction *transaction in queue.transactions) {
		if ([transactionId isEqualToString:transaction.transactionIdentifier]) {
			[queue finishTransaction:transaction];
		}
	}
}